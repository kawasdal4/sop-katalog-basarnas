// Development Schema - SQLite (Local)
// For production, use PostgreSQL on Vercel

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// User model with role-based access
model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  name      String
  role      String   @default("STAF") // ADMIN or STAF
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // Relations
  logs     Log[]
  sopFiles SopFile[]
}

// SOP/IK File model
model SopFile {
  id           String   @id @default(cuid())
  nomorSop     String   @unique // SOP-0001, IK-0001, etc
  judul        String
  tahun        Int
  kategori     String   // SIAGA, LATIHAN, LAINNYA
  jenis        String   // SOP or IK
  status       String   @default("AKTIF") // AKTIF, REVIEW, KADALUARSA
  
  // File info
  fileName     String
  filePath     String
  fileType     String   // xlsx or pdf
  driveFileId  String?  // Google Drive file ID
  
  // Upload info
  uploadedBy   String
  uploadedAt   DateTime @default(now())
  
  // For public submissions
  isPublicSubmission Boolean   @default(false)
  submitterName      String?
  submitterEmail     String?
  verificationStatus String?   @default("MENUNGGU") // MENUNGGU, DISETUJUI, DITOLAK
  verifiedBy         String?
  verifiedAt         DateTime?
  
  // Relations
  user     User     @relation(fields: [uploadedBy], references: [id])
  logs     Log[]
  
  updatedAt DateTime @updatedAt
}

// Activity Log model
model Log {
  id          String   @id @default(cuid())
  userId      String
  aktivitas   String   // UPLOAD, DOWNLOAD, PREVIEW, EDIT_STATUS, VERIFIKASI, LOGIN
  deskripsi   String
  fileId      String?
  createdAt   DateTime @default(now())
  
  // Relations
  user    User     @relation(fields: [userId], references: [id])
  sopFile SopFile? @relation(fields: [fileId], references: [id])
}

// Counter for auto-generate nomor SOP
model Counter {
  id        String @id @default("counter")
  sopCount  Int    @default(0)
  ikCount   Int    @default(0)
}
